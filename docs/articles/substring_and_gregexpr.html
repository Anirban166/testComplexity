<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quadratic to linear transition for substring() and gregexpr() â€¢ testComplexity</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Quadratic to linear transition for substring() and gregexpr()">
<meta property="og:description" content="testComplexity">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">testComplexity</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/testComplexity.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cDPA.html">PeakSegDP::cDPA(), a quadratic time constrained dynamic programming algorithm</a>
    </li>
    <li>
      <a href="../articles/fpop.html">fpop::Fpop(), a log-linear time segmentation algorithm</a>
    </li>
    <li>
      <a href="../articles/gfpop.html">gfpop::gfpop(), a log-linear time algorithm for constrained changepoint detection</a>
    </li>
    <li>
      <a href="../articles/opart.html">opart::gaussian(), a quadratic time optimal partioning algorithm</a>
    </li>
    <li>
      <a href="../articles/PeakSegPDPA.html">PeakSegOptimal::PeakSegPDPA(), a log-linear time algorithm for constrained changepoint detection</a>
    </li>
    <li>
      <a href="../articles/PELT_and_SegNeigh.html">PELT and SegNeigh algorithms for changepoint::cpt.mean()</a>
    </li>
    <li>
      <a href="../articles/substring_and_gregexpr.html">Quadratic to linear transition for substring() and gregexpr()</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Anirban166/testComplexity">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Quadratic to linear transition for substring() and gregexpr()</h1>
                        <h4 class="author">Anirban Chetia</h4>
            
            <h4 class="date">2020-07-20</h4>
      
      
      <div class="hidden name"><code>substring_and_gregexpr.Rmd</code></div>

    </div>

    
    
<div id="history" class="section level2">
<h2 class="hasAnchor">
<a href="#history" class="anchor"></a>History</h2>
<ul>
<li>The functions <code><a href="https://rdrr.io/r/base/substr.html">substring()</a></code> and <code><a href="https://rdrr.io/r/base/grep.html">gregexpr()</a></code> (<code>perl = TRUE</code> variant) showed quadratic time complexity for R version 3.5.2.</li>
<li>They are linear in nature (time complexity wise) starting from R version 3.6.0, after the commits to <a href="https://github.com/wch/r-source/commit/4931902af83938a21f4d3f8fa0fce81ad062f2c1">substring</a> and <a href="https://github.com/wch/r-source/commit/98d247645ba95270bd14790284500a699caebf52">gregexpr</a> by Tomas Kalibera, as suggested by Toby Dylan Hocking and mentioned <a href="https://github.com/tdhock/namedCapture-article#6-mar-2019">here</a>.</li>
</ul>
</div>
<div id="issues" class="section level2">
<h2 class="hasAnchor">
<a href="#issues" class="anchor"></a>Issues</h2>
<p>Initially, the PCRE (perl set) version of regexpr repeatedly scanned the entire input string to ensure it is valid UTF-8, which accounts for the time being proportional to the square of the number of pattern matches in the input strings, resulting in quadratic complexity. (same was observed in the PCRE version of <code><a href="https://rdrr.io/r/base/strsplit.html">strsplit()</a></code> as well)</p>
<p>After this issue was resolved with a following patch for the gregexpr function, a similar case of quadratic time complexity over the expected linear complexity was observed in <code><a href="https://rdrr.io/r/base/substr.html">substring()</a></code> and the functions from other packages such as rex, rematch2 and namedCapture which interally use it. A figure showcasing the quadratic trend of functions from the mentioned packages which use <code><a href="https://rdrr.io/r/base/substr.html">substring()</a></code> internally, namely <code><a href="https://rdrr.io/pkg/rex/man/re_matches.html">rex::re_matches</a></code>, <code><a href="https://rdrr.io/pkg/rematch2/man/re_match_all.html">rematch2::re_match_all</a></code> and <code>namedCapture::str_match_all_named</code> in comparison to the linear functions such as gregexpr after the patch, can be found <a href="https://github.com/tdhock/namedCapture-article/blob/master/figure-trackDb-pkgs.png">here</a>.</p>
<p>After avoiding the repeated calls to <code>strlen</code>, the extra check for UTF-8 validity and buffering for the same via this <a href="https://github.com/wch/r-source/commit/4931902af83938a21f4d3f8fa0fce81ad062f2c1">commit</a>, <code><a href="https://rdrr.io/r/base/substr.html">substring()</a></code> now shows linear time complexity.</p>
<p>The HTML pages which provide ready reference for the aforementioned issues can be found below. (source for extracting information on the topic)</p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<ul>
<li>
<code>gregexpr</code>: <a href="https://stat.ethz.ch/pipermail/r-devel/2017-January/073577.html" class="uri">https://stat.ethz.ch/pipermail/r-devel/2017-January/073577.html</a>
</li>
<li>
<code>substring</code>: <a href="https://stat.ethz.ch/pipermail/r-devel/2019-February/077318.html" class="uri">https://stat.ethz.ch/pipermail/r-devel/2019-February/077318.html</a>
</li>
</ul>
</div>
<div id="reproducibility" class="section level2">
<h2 class="hasAnchor">
<a href="#reproducibility" class="anchor"></a>Reproducibility</h2>
<p><a href="https://github.com/tdhock/namedCapture-article/blob/master/figure-substring-bug.png">This figure</a> highlights the quadratic trend in the substring function (<a href="https://github.com/tdhock/namedCapture-article/blob/master/figure-substring-bug.R">source code</a>), as provided by Toby Dylan Hocking. One would require an R version prior to 3.6.0 to reproduce that, which reflects the origin of the issue with those functions. The issues and their timeline as per <a href="https://github.com/tdhock">tdhock</a>â€™s activity are discussed in <a href="https://github.com/tdhock/namedCapture-article">this</a> article for the package namedCapture.</p>
</div>
<div id="testing" class="section level2">
<h2 class="hasAnchor">
<a href="#testing" class="anchor"></a>Testing</h2>
<p>This is where testComplexity can be useful, so as to verify the change in time complexity after resolution of the issues. A run with our time complexity analysis functions <code>asymptoticTimings</code> and <code>asymptoticTimeComplexityClass</code> with suitable parameters show that both substring and gregexpr yield linear time complexity:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">testComplexity</span>)
<span class="co"># substring function test:</span>
<span class="fu"><a href="../reference/asymptoticTimeComplexityClass.html">asymptoticTimeComplexityClass</a></span>(<span class="fu"><a href="../reference/asymptoticTimings.html">asymptoticTimings</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/substr.html">substring</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"A"</span>, <span class="no">N</span>), <span class="kw">collapse</span> <span class="kw">=</span> <span class="st">""</span>), <span class="fl">1</span>:<span class="no">N</span>, <span class="fl">1</span>:<span class="no">N</span>), <span class="kw">data.sizes</span> <span class="kw">=</span> <span class="fl">10</span>^<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>, <span class="fl">5</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">0.5</span>), <span class="kw">max.seconds</span> <span class="kw">=</span> <span class="fl">1</span>))
<span class="co">#&gt; [1] "linear"</span>
<span class="co"># gregexpr function test:</span>
<span class="fu"><a href="../reference/asymptoticTimeComplexityClass.html">asymptoticTimeComplexityClass</a></span>(<span class="fu"><a href="../reference/asymptoticTimings.html">asymptoticTimings</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">gregexpr</a></span>(<span class="st">"a"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="kw">collapse</span> <span class="kw">=</span> <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"ab"</span>, <span class="no">N</span>)), <span class="kw">perl</span> <span class="kw">=</span> <span class="fl">TRUE</span>), <span class="kw">data.sizes</span> <span class="kw">=</span> <span class="fl">10</span>^<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>, <span class="fl">5</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">0.5</span>), <span class="kw">max.seconds</span> <span class="kw">=</span> <span class="fl">1</span>))
<span class="co">#&gt; [1] "linear"</span></pre></body></html></div>
<p><sup>Created on 2020-08-17 by the <a href="https://reprex.tidyverse.org">reprex package</a> (v0.3.0)</sup></p>
<p>Do note that sometimes the predicted complexity class may be log linear instead of linear, as the complexity classification procedure relies on the least error from each of the complexity classification models, and depending on the benchmarks run (which always vary) within asymptoticTimings, it is prone to misprediction by the stochastic nature of timings obtained. It is well recieved that it never shows quadratic in any case (also, plots such as <a href="https://github.com/Anirban166/testComplexity/issues/15#issuecomment-647085864">this</a> highlight the stark contrast between quadratic time algorithms and the linear ones such as substring and gregexpr), which supports the resolution of the issues.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer>      <div class="copyright">
        <p>Developed by <a href="https://github.com/Anirban166">Anirban</a>.</p>
      </div>
      
      <div class="pkgdown">
        <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a>.</p>
      </div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'd84f81326b636909ead6500a3882606c',
    indexName: 'testcomplexity',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
